<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">

<head>
    <title>Банк</title>
</head>

<body>
<a href="/signup" style="float:right;">
    <b>РЕГИСТРАЦИЯ &plus;</b>
</a>
<br>
<a href="/logout" style="float:right;">
    <b>ВЫЙТИ &cudarrr;</b>
</a>
<table style="width:70%;margin-left:auto;margin-right:auto;">
    <tr><td style="padding:2px;">
        <form method="post" th:action="${'/user/'+login+'/editPassword'}">
        <table style="width:100%;margin-left:auto;margin-right:auto;border-radius:2%;padding:10px;background-color:whitesmoke;">
            <tr>
                <td style="font-weight:bold;">Логин</td>
                <td colspan="2" th:text="${login}"/>
            </tr>
            <tr>
                <td style="font-weight:bold;">Изменить пароль</td>
                <td>
                    <p style="color:red;" th:if="${passwordErrors!=null}" th:each="passwordError : ${passwordErrors}" th:text="${passwordError}"/>
                    <p>
                        Пароль: <input name="password" type="password" required/>
                    </p>
                    <p>
                        Повторите пароль: <input name="confirm_password" type="password" required/>
                    </p>
                </td>
                <td style="text-align:right">
                    <button>Изменить пароль</button>
                </td>
            </tr>
        </table>
        </form>
    </td>
    <tr><td style="padding:2px;">
        <form method="post" th:action="${'/user/'+login+'/editUserAccount'}">
        <table style="width:100%;margin-left:auto;margin-right:auto;border-radius:2%;padding:10px;background-color:whitesmoke;">
            <tr th:if="${userAccountErrors!=null}" th:each="userAccountError : ${userAccountErrors}">
                <td style="color:red;" th:text="${userAccountError}"/>
            </tr>
            <tr>
                <td style="font-weight:bold;">Фамилия Имя</td>
                <td th:text="${name}"/>
                <td>
                    <input name="name" type="text" style="width:100%"/>
                </td>
            </tr>
            <tr>
                <td style="font-weight:bold;">Дата рождения</td>
                <td th:text="${birthdate}"/>
                <td>
                    <input name="birthdate" type="date" style="width:100%"/>
                </td>
            </tr>
            <tr>
                <td style="text-align:right" colspan="3">
                    <button>Сохранить изменения</button>
                </td>
            </tr>
        </table>
        </form>
    </td></tr>
    <tr><td style="padding:2px;">
        <form method="post" th:action="${'/user/'+login+'/cash'}">
            <table style="width:100%;margin-left:auto;margin-right:auto;border-radius:2%;padding:10px;background-color:whitesmoke;">
                <tr th:if="${cashErrors!=null}" th:each="cashError : ${cashErrors}">
                    <td style="color:red;" th:text="${cashError}"/>
                </tr>
                <tr>
                    <td style="font-weight:bold;">Наличные</td>
                    <td>
                        <input name="value" type="number" style="width:100%" required/>
                    </td>
                    <td>
                    <td style="text-align:right">
                        <button name="action" value="PUT">Положить</button>
                        <button name="action" value="GET">Снять</button>
                    </td>
                </tr>
            </table>
        </form>
    </td></tr>
    <tr><td style="padding:2px;">
        <form method="post" th:action="${'/user/'+login+'/transfer'}">
            <table style="width:100%;margin-left:auto;margin-right:auto;border-radius:2%;padding:10px;background-color:whitesmoke;">
                <tr>
                    <td colspan="4" style="font-weight:bold;">Перевод между своими счетами</td>
                </tr>
                <tr th:if="${transferOtherErrors!=null}" th:each="transferOtherError : ${transferOtherErrors}">
                    <td colspan="4" style="color:red;" th:text="${transferOtherError}"/>
                </tr>
                <tr>
                    <td style="font-weight:bold;">Со счёта</td>
                    <td colspan="3">
                        <input type="hidden" name="to_login" th:value="${login}"/>
                        <select name="from_account" style="width:100%" th:disabled="${accounts==null or accounts.size()<1}">
                            <option th:each="acc : ${accounts}"
                                    th:value="${acc.id()}"
                                    th:text="|${acc.accountNumber()} (${acc.currency()}, ${acc.balance()})|"/>
                        </select>
                    </td>
                </tr>
                <tr>
                    <td style="font-weight:bold;">На счёт</td>
                    <td colspan="3">
                        <select name="to_account" style="width:100%" th:disabled="${accounts==null or accounts.size()<2}">
                            <option th:each="acc : ${accounts}"
                                    th:value="${acc.id()}"
                                    th:text="|${acc.accountNumber()} (${acc.currency()}, ${acc.balance()})|"/>
                        </select>
                    </td>
                </tr>
                <tr>
                    <td style="font-weight:bold;">Сумма</td>
                    <td><input name="value" type="number" step="0.01" required/></td>
                    <td/>
                    <td style="text-align:right">
                        <button th:disabled="${accounts==null or accounts.size()<2}">Перевести</button>
                    </td>
                </tr>
                <tr th:if="${accounts!=null and accounts.size()<2}">
                    <td colspan="4" style="color:gray;">Для перевода между своими счетами нужен хотя бы один дополнительный счёт.</td>
                </tr>
            </table>
        </form>
    </td></tr>

    <tr><td style="padding:2px;">
        <form method="post" th:action="${'/user/'+login+'/transfer'}">
            <table style="width:100%;margin-left:auto;margin-right:auto;border-radius:2%;padding:10px;background-color:whitesmoke;">
                <tr>
                    <td colspan="4" style="font-weight:bold;">Перевод на другой аккаунт</td>
                </tr>
                <tr th:if="${transferOtherErrors!=null}" th:each="transferOtherError : ${transferOtherErrors}">
                    <td colspan="4" style="color:red;" th:text="${transferOtherError}"/>
                </tr>
                <tr>
                    <td style="font-weight:bold;">Со счёта</td>
                    <td colspan="3">
                        <select name="from_account" style="width:100%" th:disabled="${accounts==null or accounts.size()<1}">
                            <option th:each="acc : ${accounts}"
                                    th:value="${acc.id()}"
                                    th:text="|${acc.accountNumber()} (${acc.currency()}, ${acc.balance()})|"/>
                        </select>
                    </td>
                </tr>
                <tr>
                    <td style="font-weight:bold;">Кому</td>
                    <td>
                        <select name="to_login">
                            <option th:each="user : ${users}" th:value="${user.login}" th:text="${user.name}"/>
                        </select>
                    </td>
                    <td style="font-weight:bold;">Сумма</td>
                    <td><input name="value" type="number" step="0.01" required/></td>
                </tr>
                <tr>
                    <td colspan="4" style="text-align:right">
                        <button>Перевести</button>
                    </td>
                </tr>
            </table>
        </form>
    </td></tr>
    <tr><td style="padding:2px;">
        <table style="width:100%;margin-left:auto;margin-right:auto;border-radius:2%;padding:10px;background-color:whitesmoke;">
            <tr>
                <td colspan="3" style="font-weight:bold;">
                    Курсы валют
                    <span th:if="${rates!=null and !#lists.isEmpty(rates)}">
                        (базовая валюта — <span th:text="${rates.get(0).baseCurrency()}"></span>)
                    </span>
                </td>
            </tr>
            <tr th:if="${rates==null or #lists.isEmpty(rates)}">
                <td colspan="3">Курсы временно недоступны.</td>
            </tr>
            <tr th:if="${rates!=null and !#lists.isEmpty(rates)}" style="font-weight:bold;">
                <td>Валюта</td>
                <td>Покупка</td>
                <td>Продажа</td>
            </tr>
            <tr th:each="rate : ${rates}">
                <td th:text="${rate.currency()}"/>
                <td th:text="${rate.buyRate()}"/>
                <td th:text="${rate.sellRate()}"/>
            </tr>
        </table>
    </td></tr>
</table>
</body>

</html>
